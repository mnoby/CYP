pipeline{
    //untuk define dimana mau dirun (slave)
    agent{
        node{
            label 'docker-chrome'
        }
    }

    //kumpulan task yang akan kita assign dijob tsb
    //Task: run automation test
    //1. clone source code, masuk kedalam project (bisa di skip karena jenkins sudah auto clone)
    //2. install depedencies
    //3. run all test
    //4. generate report
    stages{
        stage('intall dependencies'){
            steps{
                //semua task operation bisa ditulis disini
                sh "npm ci"
            }

        }

        stage('run all test'){
            steps{
                sh "npm test"
            }

        }

        stage('generate report'){
            steps{
                sh "npm run reporter"
                sh "ls cypress/reports"
                publishHTML([
                    allowMissing: false, 
                    alwaysLinkToLastBuild: true, 
                    keepAll: true, 
                    reportDir: 'cypress/reports/', 
                    reportFiles: 'index.html', 
                    reportName: 'BDD Atlas MultiCucumber Reporter', 
                    reportTitles: ''])
            }

        }
    }

    //yang akan diexecute setelah semua staged
    //always =>
    //failed =>
    //success =>
    post{
        always{
            echo "ini adalah post{}"
        }
    }
}